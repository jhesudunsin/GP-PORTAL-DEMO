<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Tools Portal - GP Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header .practice-name {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .urgent-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 15px 30px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .urgent-banner.show {
            display: block;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            color: #1e3c72;
            border-bottom-color: #1e3c72;
            background: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
            color: #495057;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .card-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .card-label {
            color: #6c757d;
            font-weight: 600;
        }

        .compliant { color: #28a745; }
        .non-compliant { color: #dc3545; }
        .pending { color: #ffc107; }
        .total { color: #667eea; }

        .quick-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tools-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .tools-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .tools-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .tools-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .tools-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-compliant {
            background: #d4edda;
            color: #155724;
        }

        .status-action-required {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

        .help-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .help-link:hover {
            text-decoration: underline;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .assessment-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .assessment-section h3 {
            margin-bottom: 15px;
            color: #1e3c72;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #bee5eb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #c3e6cb;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f5c6cb;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .hidden {
            display: none;
        }

        .show {
            display: block;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            min-width: auto;
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .form-buttons {
                flex-direction: column;
            }

            .content {
                padding: 15px;
            }

            .tools-table {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Digital Tools Portal</h1>
            <div class="practice-name">Mickleover Medical Centre - Derby City PCN</div>
        </div>

        <div class="urgent-banner" id="urgentBanner">
            ‚ö†Ô∏è Action Required: You have 2 tools that need immediate compliance updates
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('tools')">üîß Our Tools</button>
            <button class="nav-tab" onclick="showTab('assessment')">üìã Monthly Check</button>
            <button class="nav-tab" onclick="showTab('reports')">üìä Reports</button>
            <button class="nav-tab" onclick="showTab('help')">‚ùì Help</button>
        </div>

        <div class="content">
            <!-- Success/Error Messages -->
            <div id="successMessage" class="success-message"></div>
            <div id="errorMessage" class="error-message"></div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-number total" id="totalTools">6</div>
                        <div class="card-label">Tools Registered</div>
                    </div>
                    <div class="card">
                        <div class="card-number compliant" id="compliantTools">4</div>
                        <div class="card-label">Compliant</div>
                    </div>
                    <div class="card">
                        <div class="card-number non-compliant" id="actionRequired">2</div>
                        <div class="card-label">Action Required</div>
                    </div>
                    <div class="card">
                        <div class="card-number pending" id="pendingReview">0</div>
                        <div class="card-label">Pending Review</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="showAddTool()">+ Add New Tool</button>
                    <button class="btn btn-warning" onclick="showTab('assessment')">Complete Monthly Check</button>
                    <button class="btn btn-success" onclick="showUpdateAllModal()">Update Tool Status</button>
                </div>

                <div class="notification">
                    <strong>üìÖ Reminder:</strong> Your monthly digital tools assessment is due by June 30th, 2025.
                </div>

                <div class="tools-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Tool Name</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="toolsTableBody">
                            <!-- Table content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Our Tools Tab -->
            <div id="tools" class="tab-content">
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="showAddTool()">+ Add New Tool</button>
                    <button class="btn btn-success" onclick="showUpdateAllModal()">Update All Statuses</button>
                    <button class="btn btn-warning" onclick="exportToolsList()">Export Our Tools</button>
                </div>

                <div class="form-container" id="addToolForm" style="display: none;">
                    <h3>Add New Digital Tool</h3>
                    <form id="newToolForm" onsubmit="submitNewTool(event)">
                        <div class="form-group">
                            <label>What tool are you using? <span style="color: red;">*</span></label>
                            <input type="text" id="toolName" placeholder="e.g. Dragon Medical One, AccuRx, Teams" required>
                            <div class="help-text">Enter the exact name of the software or system</div>
                        </div>

                        <div class="form-group">
                            <label>What type of tool is this? <span style="color: red;">*</span></label>
                            <select id="toolType" required>
                                <option value="">Select tool type...</option>
                                <option value="AI Voice Technology">AI Voice/Speech Recognition</option>
                                <option value="Online Consultation">Online Consultation (e.g. AccuRx)</option>
                                <option value="Video Consultation">Video Consultation</option>
                                <option value="Clinical Decision Support">Clinical Decision Support</option>
                                <option value="Administrative Tool">Administrative Tool</option>
                                <option value="Other">Other (please specify below)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Who supplies this tool?</label>
                            <input type="text" id="toolVendor" placeholder="e.g. Nuance, AccuRx Ltd, Microsoft">
                            <div class="help-text">Company or vendor name</div>
                        </div>

                        <div class="form-group">
                            <label>How long have you been using it?</label>
                            <select id="toolDuration">
                                <option value="">Select duration...</option>
                                <option value="Less than 6 months">Less than 6 months</option>
                                <option value="6-12 months">6-12 months</option>
                                <option value="1-2 years">1-2 years</option>
                                <option value="More than 2 years">More than 2 years</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Do you have a contract for this tool?</label>
                            <select id="contractExists">
                                <option value="">Select...</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="Don't Know">Don't Know</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Has this tool been approved for NHS use?</label>
                            <select id="nhsApproved">
                                <option value="">Select...</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="Don't Know">Don't Know</option>
                            </select>
                            <div class="help-text">This means it meets MHRA and NHS Digital requirements</div>
                        </div>

                        <div class="form-group">
                            <label>Have you completed a Data Protection Impact Assessment (DPIA)?</label>
                            <select id="dpiaStatus">
                                <option value="">Select...</option>
                                <option value="Yes - Completed">Yes - Completed</option>
                                <option value="No - Not Done">No - Not Done</option>
                                <option value="Don't Know">Don't Know</option>
                                <option value="What's a DPIA?">What's a DPIA?</option>
                            </select>
                            <div class="help-text">This checks if patient data is handled safely. <a href="#" class="help-link" onclick="showDPIAHelp()">Need help with DPIA?</a></div>
                        </div>

                        <div class="form-group">
                            <label>Has a clinical safety assessment been done?</label>
                            <select id="clinicalSafety">
                                <option value="">Select...</option>
                                <option value="Yes - Complete">Yes - Complete</option>
                                <option value="No - Not Done">No - Not Done</option>
                                <option value="Don't Know">Don't Know</option>
                                <option value="Need Help">Need Help</option>
                            </select>
                            <div class="help-text">This ensures the tool is safe for patient care. <a href="#" class="help-link" onclick="showClinicalSafetyHelp()">Get help with assessment</a></div>
                        </div>

                        <div class="form-group">
                            <label>Additional Notes</label>
                            <textarea id="toolNotes" rows="3" placeholder="Any other information about this tool..."></textarea>
                        </div>

                        <div class="form-buttons">
                            <button type="submit" class="btn btn-primary">Save Tool</button>
                            <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="hideAddTool()">Cancel</button>
                        </div>
                    </form>
                </div>

                <div class="tools-table">
                    <h4 style="margin-bottom: 15px;">All Our Digital Tools</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Tool Name</th>
                                <th>Type</th>
                                <th>Vendor</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allToolsTableBody">
                            <!-- Table content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Monthly Assessment Tab -->
            <div id="assessment" class="tab-content">
                <div class="form-container">
                    <h3>Monthly Digital Tools Assessment</h3>
                    <p style="margin-bottom: 20px; color: #6c757d;">This quick check helps us ensure all your digital tools remain safe and compliant. Takes about 5 minutes.</p>

                    <form id="monthlyAssessmentForm" onsubmit="submitAssessment(event)">
                        <div class="assessment-section">
                            <h3>1. New Tools Check</h3>
                            <div class="form-group">
                                <label>Are you using any NEW digital tools since last month?</label>
                                <select id="newToolsCheck" onchange="toggleNewToolsSection(this.value)">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div id="newToolsSection" style="display: none;">
                                <p style="margin: 10px 0;">Please add them using the "Add New Tool" section.</p>
                                <button type="button" class="btn btn-primary" onclick="showTab('tools'); showAddTool();">Add New Tool</button>
                            </div>
                        </div>

                        <div class="assessment-section">
                            <h3>2. Stopped Using Tools</h3>
                            <div class="form-group">
                                <label>Have you STOPPED using any tools since last month?</label>
                                <select id="stoppedToolsCheck" onchange="toggleStoppedToolsSection(this.value)">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div id="stoppedToolsSection" style="display: none;">
                                <p style="margin: 10px 0; font-weight: 600;">Which tools have you stopped using?</p>
                                <div class="checkbox-group" id="stoppedToolsList">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <div class="assessment-section">
                            <h3>3. Safety & Compliance Check</h3>
                            <div class="form-group">
                                <label>Are any tools causing patient safety concerns?</label>
                                <select id="safetyCheck">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes - Urgent</option>
                                    <option value="no">No</option>
                                </select>
                                <div class="help-text">If Yes, this will send an immediate alert to the ICB team</div>
                            </div>

                            <div class="form-group">
                                <label>Do you have any expired contracts?</label>
                                <select id="expiredContracts">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                    <option value="unknown">Don't Know</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Do you need help with compliance for any tools?</label>
                                <select id="needHelp">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes - Please Contact Me</option>
                                    <option value="no">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Additional Comments</label>
                                <textarea id="assessmentNotes" rows="3" placeholder="Any other concerns or updates..."></textarea>
                            </div>
                        </div>

                        <div class="form-buttons">
                            <button type="submit" class="btn btn-success">Complete Monthly Check</button>
                            <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="resetAssessmentForm()">Reset Form</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <div class="form-container">
                    <h3>Our Compliance Reports</h3>
                    
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="generateReport('current')">Current Status Report</button>
                        <button class="btn btn-success" onclick="generateReport('history')">Historical Report</button>
                        <button class="btn btn-warning" onclick="generateReport('compliance')">Compliance Summary</button>
                    </div>

                    <div id="reportOutput" class="form-container" style="display: none;">
                        <h4>Generated Report</h4>
                        <div id="reportContent"></div>
                        <div class="form-buttons">
                            <button class="btn btn-primary" onclick="downloadReport()">Download Report</button>
                            <button class="btn" style="background: #6c757d; color: white;" onclick="hideReport()">Close</button>
                        </div>
                    </div>

                    <div class="tools-table">
                        <h4 style="margin-bottom: 15px;">Recent Activity</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Activity</th>
                                    <th>Tool</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="activityTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Help Tab -->
            <div id="help" class="tab-content">
                <div class="form-container">
                    <h3>Help & Support</h3>
                    
                    <div class="assessment-section">
                        <h3>‚ùì Frequently Asked Questions</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What is a DPIA (Data Protection Impact Assessment)?</h4>
                            <p>A DPIA is a process to help you identify and minimise the data protection risks of a project. It's required when using new technology that processes patient data.</p>
                            <button class="btn btn-primary btn-small" onclick="contactICBTeam('DPIA Help')">Get DPIA Help</button>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What is Clinical Safety Assessment (DCB0160)?</h4>
                            <p>This is a standard that ensures clinical software is safe for patient care. It includes risk assessment and safety documentation.</p>
                            <button class="btn btn-primary btn-small" onclick="contactICBTeam('Clinical Safety Help')">Get Clinical Safety Help</button>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What does MHRA compliance mean?</h4>
                            <p>MHRA (Medicines and Healthcare products Regulatory Agency) ensures medical devices meet safety standards. AI tools used in healthcare need MHRA approval.</p>
                            <button class="btn btn-primary btn-small" onclick="contactICBTeam('MHRA Help')">Get MHRA Help</button>
                        </div>
                    </div>

                    <div class="assessment-section">
                        <h3>üìû Contact ICB Digital Team</h3>
                        <p>Need help with compliance, assessments, or have questions about your digital tools?</p>
                        
                        <div class="quick-actions">
                            <button class="btn btn-primary" onclick="contactICBTeam('General Support')">üí¨ Chat with Digital Team</button>
                            <button class="btn btn-success" onclick="contactICBTeam('Compliance Help')">üìã Request Compliance Help</button>
                            <button class="btn btn-danger" onclick="contactICBTeam('Problem Report')">üö® Report a Problem</button>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <h4>Emergency Contact</h4>
                            <p><strong>Phone:</strong> 01332 868 400</p>
                            <p><strong>Email:</strong> digitaltools@derbyshireicb.nhs.uk</p>
                            <p><strong>Hours:</strong> Monday-Friday, 8:00 AM - 6:00 PM</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Tool Modal -->
    <div id="updateToolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Tool Status</h3>
                <button class="close" onclick="closeUpdateModal()">&times;</button>
            </div>
            
            <div id="toolUpdateForm">
                <p>Updating: <strong id="updateToolName">Dragon Medical One</strong></p>
                
                <form id="updateForm" onsubmit="saveToolUpdate(event)">
                    <div class="form-group">
                        <label>Has anything changed with this tool?</label>
                        <select id="hasChanged" onchange="toggleUpdateFields(this.value)">
                            <option value="">Select...</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <div id="updateFields" style="display: none;">
                        <div class="form-group">
                            <label>What changed? (select all that apply)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="change-version">
                                    <label for="change-version">New version/update</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="change-compliance">
                                    <label for="change-compliance">Completed compliance assessment</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="change-contract">
                                    <label for="change-contract">Contract renewed</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="change-stopped">
                                    <label for="change-stopped">Stopped using this tool</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>DPIA Status</label>
                            <select id="updateDPIA">
                                <option value="">Current status...</option>
                                <option value="complete">‚úÖ Now Complete</option>
                                <option value="progress">üîÑ In Progress</option>
                                <option value="notdone">‚ùå Not Done Yet</option>
                                <option value="help">‚ùì Need Help</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Clinical Safety Assessment</label>
                            <select id="updateClinicalSafety">
                                <option value="">Current status...</option>
                                <option value="complete">‚úÖ Now Complete</option>
                                <option value="progress">üîÑ In Progress</option>
                                <option value="notdone">‚ùå Not Done Yet</option>
                                <option value="help">‚ùì Need Help</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>NHS/MHRA Approval</label>
                            <select id="updateMHRA">
                                <option value="">Current status...</option>
                                <option value="approved">‚úÖ Now Approved</option>
                                <option value="pending">üîÑ Pending Approval</option>
                                <option value="notapproved">‚ùå Not Approved</option>
                                <option value="unknown">‚ùì Don't Know</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Additional Notes</label>
                            <textarea id="updateNotes" rows="3" placeholder="Any other updates or comments..."></textarea>
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn btn-success">Save Update</button>
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeUpdateModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Update All Tools Modal -->
    <div id="updateAllModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update All Tool Statuses</h3>
                <button class="close" onclick="closeUpdateAllModal()">&times;</button>
            </div>
            
            <p>Quick update for all tools that need attention:</p>
            
            <div id="updateAllList">
                <!-- Will be populated by JavaScript -->
            </div>

            <div class="form-buttons">
                <button class="btn btn-success" onclick="saveAllUpdates()">Save All Updates</button>
                <button class="btn" style="background: #6c757d; color: white;" onclick="closeUpdateAllModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Contact ICB Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Contact ICB Digital Team</h3>
                <button class="close" onclick="closeContactModal()">&times;</button>
            </div>
            
            <form id="contactForm" onsubmit="submitContactRequest(event)">
                <div class="form-group">
                    <label>Request Type</label>
                    <select id="contactType" required>
                        <option value="">Select...</option>
                        <option value="DPIA Help">DPIA Help</option>
                        <option value="Clinical Safety Help">Clinical Safety Help</option>
                        <option value="MHRA Help">MHRA Help</option>
                        <option value="General Support">General Support</option>
                        <option value="Compliance Help">Compliance Help</option>
                        <option value="Problem Report">Problem Report</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tool Name (if applicable)</label>
                    <input type="text" id="contactToolName" placeholder="Which tool do you need help with?">
                </div>

                <div class="form-group">
                    <label>Your Message <span style="color: red;">*</span></label>
                    <textarea id="contactMessage" rows="4" placeholder="Describe your question or issue..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Contact Preference</label>
                    <select id="contactPreference">
                        <option value="email">Email</option>
                        <option value="phone">Phone Call</option>
                        <option value="meeting">Video Meeting</option>
                    </select>
                </div>

                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Send Request</button>
                    <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeContactModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample data for the practice
        let practiceTools = [
            {
                id: 1,
                name: "AccuRx",
                type: "Online Consultation",
                vendor: "AccuRx Ltd",
                status: "Compliant",
                lastUpdated: "01/06/25",
                dpiaStatus: "Complete",
                clinicalSafety: "Complete",
                mhraStatus: "Approved",
                duration: "More than 2 years",
                contract: "Yes",
                notes: "Fully compliant system"
            },
            {
                id: 2,
                name: "Dragon Medical One",
                type: "AI Voice Technology",
                vendor: "Nuance Communications",
                status: "Action Required",
                lastUpdated: "15/05/25",
                dpiaStatus: "Not Done",
                clinicalSafety: "Not Done",
                mhraStatus: "Unknown",
                duration: "6-12 months",
                contract: "Yes",
                notes: "Needs compliance review"
            },
            {
                id: 3,
                name: "Attend Anywhere",
                type: "Video Consultation",
                vendor: "Attend Anywhere Ltd",
                status: "Compliant",
                lastUpdated: "10/06/25",
                dpiaStatus: "Complete",
                clinicalSafety: "Complete",
                mhraStatus: "Approved",
                duration: "1-2 years",
                contract: "Yes",
                notes: "Regular reviews scheduled"
            },
            {
                id: 4,
                name: "EMIS Web",
                type: "Clinical System",
                vendor: "EMIS Health",
                status: "Compliant",
                lastUpdated: "05/06/25",
                dpiaStatus: "Complete",
                clinicalSafety: "Complete",
                mhraStatus: "Approved",
                duration: "More than 2 years",
                contract: "Yes",
                notes: "Primary clinical system"
            },
            {
                id: 5,
                name: "Microsoft Copilot",
                type: "AI Assistant",
                vendor: "Microsoft",
                status: "Action Required",
                lastUpdated: "Never",
                dpiaStatus: "Not Done",
                clinicalSafety: "Not Done",
                mhraStatus: "Not Approved",
                duration: "Less than 6 months",
                contract: "No",
                notes: "Informal usage - needs assessment"
            },
            {
                id: 6,
                name: "DocuSign",
                type: "Digital Signatures",
                vendor: "DocuSign Inc",
                status: "Compliant",
                lastUpdated: "08/06/25",
                dpiaStatus: "Complete",
                clinicalSafety: "Complete",
                mhraStatus: "Approved",
                duration: "1-2 years",
                contract: "Yes",
                notes: "Used for patient consent forms"
            }
        ];

        let activityLog = [
            { date: "15/06/25", activity: "Compliance Update", tool: "AccuRx", status: "Completed" },
            { date: "10/06/25", activity: "New Tool Added", tool: "Attend Anywhere", status: "Approved" },
            { date: "01/06/25", activity: "Monthly Assessment", tool: "All Tools", status: "Completed" },
            { date: "25/05/25", activity: "DPIA Review", tool: "EMIS Web", status: "Completed" },
            { date: "20/05/25", activity: "Contract Renewal", tool: "DocuSign", status: "Completed" }
        ];

        let currentEditingTool = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            populateToolsTable();
            populateAllToolsTable();
            populateActivityTable();
            checkUrgentItems();
        });

        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Hide any open forms when switching tabs
            hideAddTool();
        }

        // Update dashboard statistics
        function updateDashboard() {
            const total = practiceTools.length;
            const compliant = practiceTools.filter(tool => tool.status === 'Compliant').length;
            const actionRequired = practiceTools.filter(tool => tool.status === 'Action Required').length;
            const pending = practiceTools.filter(tool => tool.status === 'Pending').length;

            document.getElementById('totalTools').textContent = total;
            document.getElementById('compliantTools').textContent = compliant;
            document.getElementById('actionRequired').textContent = actionRequired;
            document.getElementById('pendingReview').textContent = pending;
        }

        // Check for urgent items and show banner
        function checkUrgentItems() {
            const urgentTools = practiceTools.filter(tool => tool.status === 'Action Required');
            const banner = document.getElementById('urgentBanner');
            if (urgentTools.length > 0) {
                banner.classList.add('show');
                banner.textContent = `‚ö†Ô∏è Action Required: You have ${urgentTools.length} tools that need immediate compliance updates`;
            } else {
                banner.classList.remove('show');
            }
        }

        // Populate main tools table
        function populateToolsTable() {
            const tbody = document.getElementById('toolsTableBody');
            tbody.innerHTML = practiceTools.map(tool => {
                const statusClass = tool.status === 'Compliant' ? 'status-compliant' : 
                                   tool.status === 'Action Required' ? 'status-action-required' : 'status-pending';
                const statusIcon = tool.status === 'Compliant' ? '‚úÖ' : 
                                  tool.status === 'Action Required' ? '‚ùå' : '‚è≥';
                const actionButton = tool.status === 'Action Required' ? 
                    `<button class="btn btn-warning btn-small" onclick="updateSpecificTool(${tool.id})">Update</button>` :
                    `<button class="btn btn-primary btn-small" onclick="viewTool(${tool.id})">View</button>`;

                return `
                    <tr>
                        <td><strong>${tool.name}</strong></td>
                        <td>${tool.type}</td>
                        <td><span class="status-badge ${statusClass}">${statusIcon} ${tool.status}</span></td>
                        <td>${tool.lastUpdated}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            }).join('');
        }

        // Populate all tools table in tools tab
        function populateAllToolsTable() {
            const tbody = document.getElementById('allToolsTableBody');
            tbody.innerHTML = practiceTools.map(tool => {
                const statusClass = tool.status === 'Compliant' ? 'status-compliant' : 
                                   tool.status === 'Action Required' ? 'status-action-required' : 'status-pending';
                const statusIcon = tool.status === 'Compliant' ? '‚úÖ' : 
                                  tool.status === 'Action Required' ? '‚ùå' : '‚è≥';

                return `
                    <tr>
                        <td><strong>${tool.name}</strong></td>
                        <td>${tool.type}</td>
                        <td>${tool.vendor}</td>
                        <td><span class="status-badge ${statusClass}">${statusIcon} ${tool.status}</span></td>
                        <td>
                            <button class="btn btn-primary btn-small" onclick="viewTool(${tool.id})">View</button>
                            <button class="btn btn-warning btn-small" onclick="updateSpecificTool(${tool.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteTool(${tool.id})">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Populate activity table
        function populateActivityTable() {
            const tbody = document.getElementById('activityTableBody');
            tbody.innerHTML = activityLog.map(activity => {
                const statusClass = activity.status === 'Completed' ? 'status-compliant' : 
                                   activity.status === 'Approved' ? 'status-compliant' : 'status-pending';
                return `
                    <tr>
                        <td>${activity.date}</td>
                        <td>${activity.activity}</td>
                        <td>${activity.tool}</td>
                        <td><span class="status-badge ${statusClass}">${activity.status}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Show/hide add tool form
        function showAddTool() {
            document.getElementById('addToolForm').style.display = 'block';
            document.getElementById('addToolForm').scrollIntoView({ behavior: 'smooth' });
        }

        function hideAddTool() {
            document.getElementById('addToolForm').style.display = 'none';
            document.getElementById('newToolForm').reset();
        }

        // Submit new tool form
        function submitNewTool(event) {
            event.preventDefault();
            
            const formData = {
                id: practiceTools.length + 1,
                name: document.getElementById('toolName').value,
                type: document.getElementById('toolType').value,
                vendor: document.getElementById('toolVendor').value || 'Not specified',
                duration: document.getElementById('toolDuration').value || 'Not specified',
                contract: document.getElementById('contractExists').value || 'Unknown',
                dpiaStatus: document.getElementById('dpiaStatus').value || 'Unknown',
                clinicalSafety: document.getElementById('clinicalSafety').value || 'Unknown',
                mhraStatus: document.getElementById('nhsApproved').value || 'Unknown',
                notes: document.getElementById('toolNotes').value || '',
                status: 'Pending',
                lastUpdated: new Date().toLocaleDateString('en-GB')
            };

            // Determine status based on compliance
            if (formData.dpiaStatus.includes('Complete') && 
                formData.clinicalSafety.includes('Complete') && 
                formData.mhraStatus === 'Yes') {
                formData.status = 'Compliant';
            } else if (formData.dpiaStatus.includes('Not Done') || 
                      formData.clinicalSafety.includes('Not Done') || 
                      formData.mhraStatus === 'No') {
                formData.status = 'Action Required';
            } else {
                formData.status = 'Pending';
            }

            practiceTools.push(formData);
            
            // Add to activity log
            activityLog.unshift({
                date: new Date().toLocaleDateString('en-GB'),
                activity: 'New Tool Added',
                tool: formData.name,
                status: 'Registered'
            });

            updateDashboard();
            populateToolsTable();
            populateAllToolsTable();
            populateActivityTable();
            checkUrgentItems();
            hideAddTool();
            
            showSuccessMessage(`Tool "${formData.name}" has been successfully added and will be reviewed by the ICB team.`);
        }

        // View tool details
        function viewTool(toolId) {
            const tool = practiceTools.find(t => t.id === toolId);
            if (tool) {
                alert(`Tool Details:\n\nName: ${tool.name}\nType: ${tool.type}\nVendor: ${tool.vendor}\nStatus: ${tool.status}\nDPIA: ${tool.dpiaStatus}\nClinical Safety: ${tool.clinicalSafety}\nMHRA Status: ${tool.mhraStatus}\nNotes: ${tool.notes}`);
            }
        }

        // Update specific tool
        function updateSpecificTool(toolId) {
            const tool = practiceTools.find(t => t.id === toolId);
            if (tool) {
                currentEditingTool = tool;
                document.getElementById('updateToolName').textContent = tool.name;
                document.getElementById('updateToolModal').classList.add('show');
            }
        }

        // Show update all modal
        function showUpdateAllModal() {
            const toolsNeedingUpdate = practiceTools.filter(tool => tool.status === 'Action Required');
            const updateList = document.getElementById('updateAllList');
            
            if (toolsNeedingUpdate.length === 0) {
                showSuccessMessage('All tools are up to date! No updates required.');
                return;
            }

            updateList.innerHTML = toolsNeedingUpdate.map(tool => `
                <div class="assessment-section">
                    <h4>${tool.name}</h4>
                    <div class="form-group">
                        <label>DPIA Status</label>
                        <select id="bulk-dpia-${tool.id}">
                            <option value="">Select...</option>
                            <option value="complete">‚úÖ Complete</option>
                            <option value="progress">üîÑ In Progress</option>
                            <option value="help">‚ùì Need Help</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Clinical Safety</label>
                        <select id="bulk-safety-${tool.id}">
                            <option value="">Select...</option>
                            <option value="complete">‚úÖ Complete</option>
                            <option value="progress">üîÑ In Progress</option>
                            <option value="help">‚ùì Need Help</option>
                        </select>
                    </div>
                </div>
            `).join('');

            document.getElementById('updateAllModal').classList.add('show');
        }

        // Toggle update fields in modal
        function toggleUpdateFields(value) {
            const updateFields = document.getElementById('updateFields');
            if (value === 'yes') {
                updateFields.style.display = 'block';
            } else {
                updateFields.style.display = 'none';
            }
        }

        // Save tool update
        function saveToolUpdate(event) {
            event.preventDefault();
            
            if (!currentEditingTool) return;

            const hasChanged = document.getElementById('hasChanged').value;
            if (hasChanged === 'yes') {
                const dpiaUpdate = document.getElementById('updateDPIA').value;
                const safetyUpdate = document.getElementById('updateClinicalSafety').value;
                const mhraUpdate = document.getElementById('updateMHRA').value;
                const notes = document.getElementById('updateNotes').value;

                // Update tool properties
                if (dpiaUpdate) {
                    currentEditingTool.dpiaStatus = dpiaUpdate === 'complete' ? 'Complete' : 
                                                   dpiaUpdate === 'progress' ? 'In Progress' : 
                                                   dpiaUpdate === 'help' ? 'Need Help' : 'Not Done';
                }
                
                if (safetyUpdate) {
                    currentEditingTool.clinicalSafety = safetyUpdate === 'complete' ? 'Complete' : 
                                                       safetyUpdate === 'progress' ? 'In Progress' : 
                                                       safetyUpdate === 'help' ? 'Need Help' : 'Not Done';
                }
                
                if (mhraUpdate) {
                    currentEditingTool.mhraStatus = mhraUpdate === 'approved' ? 'Approved' : 
                                                   mhraUpdate === 'pending' ? 'Pending' : 
                                                   mhraUpdate === 'unknown' ? 'Unknown' : 'Not Approved';
                }

                if (notes) {
                    currentEditingTool.notes = notes;
                }

                // Update status based on compliance
                if (currentEditingTool.dpiaStatus === 'Complete' && 
                    currentEditingTool.clinicalSafety === 'Complete' && 
                    currentEditingTool.mhraStatus === 'Approved') {
                    currentEditingTool.status = 'Compliant';
                } else if (currentEditingTool.dpiaStatus.includes('Help') || 
                          currentEditingTool.clinicalSafety.includes('Help') || 
                          currentEditingTool.dpiaStatus === 'In Progress' || 
                          currentEditingTool.clinicalSafety === 'In Progress') {
                    currentEditingTool.status = 'Pending';
                } else {
                    currentEditingTool.status = 'Action Required';
                }

                currentEditingTool.lastUpdated = new Date().toLocaleDateString('en-GB');

                // Add to activity log
                activityLog.unshift({
                    date: new Date().toLocaleDateString('en-GB'),
                    activity: 'Status Update',
                    tool: currentEditingTool.name,
                    status: 'Updated'
                });
            }

            updateDashboard();
            populateToolsTable();
            populateAllToolsTable();
            populateActivityTable();
            checkUrgentItems();
            closeUpdateModal();
            
            showSuccessMessage(`Tool "${currentEditingTool.name}" has been updated successfully.`);
        }

        // Save all updates
        function saveAllUpdates() {
            const toolsNeedingUpdate = practiceTools.filter(tool => tool.status === 'Action Required');
            let updatedCount = 0;

            toolsNeedingUpdate.forEach(tool => {
                const dpiaSelect = document.getElementById(`bulk-dpia-${tool.id}`);
                const safetySelect = document.getElementById(`bulk-safety-${tool.id}`);
                
                if (dpiaSelect && dpiaSelect.value) {
                    tool.dpiaStatus = dpiaSelect.value === 'complete' ? 'Complete' : 
                                     dpiaSelect.value === 'progress' ? 'In Progress' : 'Need Help';
                    updatedCount++;
                }
                
                if (safetySelect && safetySelect.value) {
                    tool.clinicalSafety = safetySelect.value === 'complete' ? 'Complete' : 
                                         safetySelect.value === 'progress' ? 'In Progress' : 'Need Help';
                    updatedCount++;
                }

                // Update status
                if (tool.dpiaStatus === 'Complete' && tool.clinicalSafety === 'Complete') {
                    tool.status = 'Compliant';
                } else if (tool.dpiaStatus.includes('Help') || tool.clinicalSafety.includes('Help') || 
                          tool.dpiaStatus === 'In Progress' || tool.clinicalSafety === 'In Progress') {
                    tool.status = 'Pending';
                }

                tool.lastUpdated = new Date().toLocaleDateString('en-GB');
            });

            if (updatedCount > 0) {
                activityLog.unshift({
                    date: new Date().toLocaleDateString('en-GB'),
                    activity: 'Bulk Update',
                    tool: 'Multiple Tools',
                    status: 'Updated'
                });
            }

            updateDashboard();
            populateToolsTable();
            populateAllToolsTable();
            populateActivityTable();
            checkUrgentItems();
            closeUpdateAllModal();
            
            showSuccessMessage(`Successfully updated ${updatedCount} tool statuses.`);
        }

        // Delete tool
        function deleteTool(toolId) {
            const tool = practiceTools.find(t => t.id === toolId);
            if (tool && confirm(`Are you sure you want to delete "${tool.name}"?`)) {
                practiceTools = practiceTools.filter(t => t.id !== toolId);
                
                activityLog.unshift({
                    date: new Date().toLocaleDateString('en-GB'),
                    activity: 'Tool Removed',
                    tool: tool.name,
                    status: 'Deleted'
                });

                updateDashboard();
                populateToolsTable();
                populateAllToolsTable();
                populateActivityTable();
                checkUrgentItems();
                
                showSuccessMessage(`Tool "${tool.name}" has been removed.`);
            }
        }

        // Modal control functions
        function closeUpdateModal() {
            document.getElementById('updateToolModal').classList.remove('show');
            document.getElementById('updateForm').reset();
            currentEditingTool = null;
        }

        function closeUpdateAllModal() {
            document.getElementById('updateAllModal').classList.remove('show');
        }

        function closeContactModal() {
            document.getElementById('contactModal').classList.remove('show');
            document.getElementById('contactForm').reset();
        }

        // Assessment form functions
        function toggleNewToolsSection(value) {
            const section = document.getElementById('newToolsSection');
            if (value === 'yes') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        function toggleStoppedToolsSection(value) {
            const section = document.getElementById('stoppedToolsSection');
            if (value === 'yes') {
                // Populate with current tools
                const toolsList = document.getElementById('stoppedToolsList');
                toolsList.innerHTML = practiceTools.map(tool => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="stop-${tool.id}">
                        <label for="stop-${tool.id}">${tool.name}</label>
                    </div>
                `).join('');
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        function resetAssessmentForm() {
            document.getElementById('monthlyAssessmentForm').reset();
            document.getElementById('newToolsSection').style.display = 'none';
            document.getElementById('stoppedToolsSection').style.display = 'none';
        }

        function submitAssessment(event) {
            event.preventDefault();
            
            const formData = {
                newTools: document.getElementById('newToolsCheck').value,
                stoppedTools: document.getElementById('stoppedToolsCheck').value,
                safetyCheck: document.getElementById('safetyCheck').value,
                expiredContracts: document.getElementById('expiredContracts').value,
                needHelp: document.getElementById('needHelp').value,
                notes: document.getElementById('assessmentNotes').value
            };

            // Add to activity log
            activityLog.unshift({
                date: new Date().toLocaleDateString('en-GB'),
                activity: 'Monthly Assessment',
                tool: 'All Tools',
                status: 'Completed'
            });

            populateActivityTable();
            resetAssessmentForm();
            
            showSuccessMessage('Monthly assessment completed successfully! The ICB team has been notified.');
            
            // If safety concerns, show urgent message
            if (formData.safetyCheck === 'yes') {
                showErrorMessage('Safety concerns reported. The ICB team has been immediately notified and will contact you within 1 hour.');
            }
        }

        // Contact and help functions
        function contactICBTeam(requestType) {
            document.getElementById('contactType').value = requestType;
            document.getElementById('contactModal').classList.add('show');
        }

        function submitContactRequest(event) {
            event.preventDefault();
            
            const contactData = {
                type: document.getElementById('contactType').value,
                toolName: document.getElementById('contactToolName').value,
                message: document.getElementById('contactMessage').value,
                preference: document.getElementById('contactPreference').value
            };

            // Add to activity log
            activityLog.unshift({
                date: new Date().toLocaleDateString('en-GB'),
                activity: 'Support Request',
                tool: contactData.toolName || 'General',
                status: 'Submitted'
            });

            populateActivityTable();
            closeContactModal();
            
            showSuccessMessage(`Your ${contactData.type} request has been submitted. The ICB team will respond within 24 hours via ${contactData.preference}.`);
        }

        function showDPIAHelp() {
            alert('DPIA (Data Protection Impact Assessment) Help:\n\nA DPIA is required when:\n- Processing personal data using new technology\n- Systematic monitoring of patients\n- Processing special category health data\n\nThe ICB team can help you complete this assessment. Click "Contact ICB Team" for assistance.');
        }

        function showClinicalSafetyHelp() {
            alert('Clinical Safety Assessment Help:\n\nDCB0160 is the standard for clinical risk management of health IT systems.\n\nIt includes:\n- Clinical risk assessment\n- Safety documentation\n- Ongoing monitoring\n\nContact the ICB team for guidance on completing this assessment.');
        }

        // Report generation functions
        function generateReport(reportType) {
            const reportOutput = document.getElementById('reportOutput');
            const reportContent = document.getElementById('reportContent');
            
            let content = '';
            
            switch(reportType) {
                case 'current':
                    content = generateCurrentStatusReport();
                    break;
                case 'history':
                    content = generateHistoryReport();
                    break;
                case 'compliance':
                    content = generateComplianceReport();
                    break;
            }
            
            reportContent.innerHTML = content;
            reportOutput.style.display = 'block';
            reportOutput.scrollIntoView({ behavior: 'smooth' });
        }

        function generateCurrentStatusReport() {
            const compliant = practiceTools.filter(tool => tool.status === 'Compliant').length;
            const actionRequired = practiceTools.filter(tool => tool.status === 'Action Required').length;
            const pending = practiceTools.filter(tool => tool.status === 'Pending').length;
            
            return `
                <h4>Current Status Report - ${new Date().toLocaleDateString('en-GB')}</h4>
                <p><strong>Practice:</strong> Mickleover Medical Centre</p>
                <p><strong>Total Tools:</strong> ${practiceTools.length}</p>
                
                <h5>Compliance Summary:</h5>
                <ul>
                    <li>‚úÖ Compliant: ${compliant} tools</li>
                    <li>‚ùå Action Required: ${actionRequired} tools</li>
                    <li>‚è≥ Pending Review: ${pending} tools</li>
                </ul>
                
                <h5>Tools Requiring Action:</h5>
                ${practiceTools.filter(tool => tool.status === 'Action Required').map(tool => 
                    `<p>‚Ä¢ <strong>${tool.name}</strong> - ${tool.type}<br>
                       Issues: DPIA: ${tool.dpiaStatus}, Clinical Safety: ${tool.clinicalSafety}</p>`
                ).join('')}
                
                <h5>Compliant Tools:</h5>
                ${practiceTools.filter(tool => tool.status === 'Compliant').map(tool => 
                    `<p>‚Ä¢ <strong>${tool.name}</strong> - ${tool.type}</p>`
                ).join('')}
            `;
        }

        function generateHistoryReport() {
            return `
                <h4>Historical Activity Report - ${new Date().toLocaleDateString('en-GB')}</h4>
                <p><strong>Practice:</strong> Mickleover Medical Centre</p>
                
                <h5>Recent Activity (Last 30 Days):</h5>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #dee2e6;">Date</th>
                            <th style="padding: 10px; border: 1px solid #dee2e6;">Activity</th>
                            <th style="padding: 10px; border: 1px solid #dee2e6;">Tool</th>
                            <th style="padding: 10px; border: 1px solid #dee2e6;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${activityLog.map(activity => `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">${activity.date}</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">${activity.activity}</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">${activity.tool}</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">${activity.status}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function generateComplianceReport() {
            const dpiaComplete = practiceTools.filter(tool => tool.dpiaStatus === 'Complete').length;
            const safetyComplete = practiceTools.filter(tool => tool.clinicalSafety === 'Complete').length;
            const mhraApproved = practiceTools.filter(tool => tool.mhraStatus === 'Approved').length;
            
            return `
                <h4>Compliance Summary Report - ${new Date().toLocaleDateString('en-GB')}</h4>
                <p><strong>Practice:</strong> Mickleover Medical Centre</p>
                
                <h5>Compliance Breakdown:</h5>
                <ul>
                    <li><strong>DPIA Complete:</strong> ${dpiaComplete}/${practiceTools.length} tools (${Math.round(dpiaComplete/practiceTools.length*100)}%)</li>
                    <li><strong>Clinical Safety Complete:</strong> ${safetyComplete}/${practiceTools.length} tools (${Math.round(safetyComplete/practiceTools.length*100)}%)</li>
                    <li><strong>MHRA Approved:</strong> ${mhraApproved}/${practiceTools.length} tools (${Math.round(mhraApproved/practiceTools.length*100)}%)</li>
                </ul>
                
                <h5>Detailed Tool Status:</h5>
                ${practiceTools.map(tool => `
                    <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px;">
                        <strong>${tool.name}</strong> (${tool.type})<br>
                        DPIA: ${tool.dpiaStatus} | Clinical Safety: ${tool.clinicalSafety} | MHRA: ${tool.mhraStatus}<br>
                        <em>Status: ${tool.status}</em>
                    </div>
                `).join('')}
                
                <h5>Recommendations:</h5>
                ${actionRequired > 0 ? 
                    `<p>üî¥ <strong>Urgent:</strong> ${actionRequired} tools require immediate attention for compliance.</p>` : 
                    `<p>‚úÖ <strong>Good:</strong> All tools are compliant or under review.</p>`
                }
            `;
        }

        function downloadReport() {
            const reportContent = document.getElementById('reportContent').innerHTML;
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Digital_Tools_Report_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function hideReport() {
            document.getElementById('reportOutput').style.display = 'none';
        }

        function exportToolsList() {
            const csvContent = [
                ['Tool Name', 'Type', 'Vendor', 'Status', 'DPIA Status', 'Clinical Safety', 'MHRA Status', 'Last Updated'],
                ...practiceTools.map(tool => [
                    tool.name, tool.type, tool.vendor, tool.status, 
                    tool.dpiaStatus, tool.clinicalSafety, tool.mhraStatus, tool.lastUpdated
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Mickleover_Medical_Tools_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showSuccessMessage('Tools list exported successfully!');
        }

        // Message display functions
        function showSuccessMessage(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.classList.add('show');
            setTimeout(() => {
                successDiv.classList.remove('show');
            }, 5000);
        }

        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 8000);
        }

        // Utility functions for demo purposes
        function simulateICBResponse() {
            setTimeout(() => {
                showSuccessMessage('ICB Team Response: We have received your request and will review it within 24 hours.');
            }, 2000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close any open modals
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.classList.remove('show');
                });
                
                // Hide add tool form
                hideAddTool();
            }
        });

        // Auto-save form data (for demo purposes)
        function autoSaveFormData() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.addEventListener('change', function() {
                        // In a real application, this would save to backend
                        console.log('Auto-saving form data...');
                    });
                });
            });
        }

        // Initialize auto-save when page loads
        document.addEventListener('DOMContentLoaded', function() {
            autoSaveFormData();
        });

        // Add some demo interactivity
        function addDemoAlerts() {
            // Simulate periodic notifications
            setInterval(() => {
                if (Math.random() > 0.95) { // 5% chance every interval
                    const messages = [
                        'Reminder: Monthly assessment due in 3 days',
                        'New guidance available for AI voice tools',
                        'Contract renewal reminder for AccuRx'
                    ];
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showSuccessMessage(randomMessage);
                }
            }, 30000); // Check every 30 seconds
        }

        // Start demo alerts
        document.addEventListener('DOMContentLoaded', function() {
            // addDemoAlerts(); // Uncomment for demo notifications
        });

    </script>
</body>
</html>